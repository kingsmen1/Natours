{"mappings":"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","sources":["public/js/index.js"],"sourcesContent":["/* eslint-disable */\r\nconsole.log('index.js');\r\n\r\nconst hideAlert = () => {\r\n  const el = document.querySelector('.alert');\r\n  if (el) el.parentElement.removeChild(el);\r\n};\r\nconst showAlert = (type, msg) => {\r\n  hideAlert();\r\n  const markup = `<div class=\"alert alert--${type}\">${msg}</div>`;\r\n  document.querySelector('body').insertAdjacentHTML('afterbegin', markup);\r\n  window.setTimeout(hideAlert, 5000);\r\n};\r\n\r\n//DOM Elements\r\nconst mapBox = document.getElementById('map');\r\nconst loginForm = document.querySelector('.form--login');\r\nconst logOutButton = document.querySelector('.nav__el.nav__el--logout');\r\nconst userDataForm = document.querySelector('.form-user-data');\r\nconst userPasswordForm = document.querySelector('.form-user-password');\r\nconst tourBookButton = document.getElementById('book-tour');\r\n\r\nif (mapBox) {\r\n  //Accessing data from template and parsing.\r\n  const locations = JSON.parse(\r\n    document.getElementById('map').dataset.locations\r\n  );\r\n  console.log(locations);\r\n  const displayMap = (locations) => {\r\n    mapboxgl.accessToken =\r\n      'pk.eyJ1Ijoib3NtYW43ODYiLCJhIjoiY2xhOGY5d3VyMDJoczNvbnZpdGI0eDJiNSJ9.EYSlAQKesirYTHeEIi2wtg';\r\n    var map = new mapboxgl.Map({\r\n      container: 'map',\r\n      style: 'mapbox://styles/mapbox/light-v10',\r\n      scrollZoom: false,\r\n      //   center: [-118.113491, 34.111745],\r\n      //   zoom: 10,\r\n      //by interactive map cannot be moved.\r\n      // interactive: false,\r\n    });\r\n\r\n    const bounds = new mapboxgl.LngLatBounds();\r\n\r\n    locations.forEach((loc) => {\r\n      //Create Marker\r\n      const el = document.createElement('div');\r\n      el.className = 'marker';\r\n\r\n      //Add Marker\r\n      new mapboxgl.Marker({\r\n        element: el,\r\n        anchor: 'bottom',\r\n      })\r\n        .setLngLat(loc.coordinates)\r\n        .addTo(map);\r\n\r\n      new mapboxgl.Popup({\r\n        offset: 30,\r\n      })\r\n        .setLngLat(loc.coordinates)\r\n        .setHTML(\r\n          `<p>\r\n          Day ${loc.day}: ${loc.description}\r\n        </p>`\r\n        )\r\n        .addTo(map);\r\n\r\n      //Extend map bounds to include current location\r\n      bounds.extend(loc.coordinates);\r\n    });\r\n\r\n    //To fit map to all bounds/coordinates.\r\n    map.fitBounds(bounds, {\r\n      padding: {\r\n        top: 200,\r\n        bottom: 200,\r\n        left: 200,\r\n        right: 200,\r\n      },\r\n    });\r\n\r\n    //To add Zoom Buttons\r\n    const nav = new mapboxgl.NavigationControl();\r\n    map.addControl(nav, 'top-right');\r\n  };\r\n  displayMap(locations);\r\n}\r\n\r\nif (loginForm) {\r\n  loginForm.addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n    const email = document.getElementById('email').value;\r\n    const password = document.getElementById('password').value;\r\n\r\n    const login = async (email, password) => {\r\n      try {\r\n        //axios is used to send http methods from client side to server.\r\n        const res = await axios({\r\n          method: 'POST',\r\n          url: '/api/v1/users/login',\r\n          data: {\r\n            email,\r\n            password,\r\n          },\r\n        });\r\n\r\n        if (res.data.status === 'success') {\r\n          showAlert('success', 'Logged in successfully!');\r\n          window.setTimeout(() => {\r\n            location.assign('/');\r\n          }, 1500);\r\n        }\r\n      } catch (e) {\r\n        showAlert('error', e.response.data.message);\r\n        console.log(e.response.data.message);\r\n      }\r\n    };\r\n    login(email, password);\r\n  });\r\n}\r\n\r\nif (logOutButton) {\r\n  logOutButton.addEventListener('click', async () => {\r\n    console.log('logout function played');\r\n    try {\r\n      const res = await axios({\r\n        method: 'GET',\r\n        url: '/api/v1/users/logout',\r\n      });\r\n      // 'location.reload' It trigger's reload from server.\r\n      // It needs to set 'true' if not it will load from the same page/state from cache.\r\n      if (res.data.status == 'success') location.reload(true);\r\n    } catch (e) {\r\n      showAlert('error', 'Error logging out! Try Again .');\r\n    }\r\n  });\r\n}\r\n\r\nif (userDataForm) {\r\n  userDataForm.addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n    const form = new FormData();\r\n    form.append('name', document.getElementById('name').value);\r\n    form.append('email', document.getElementById('email').value);\r\n    //Since we receave files in an array we have to select by index.\r\n    form.append('photo', document.getElementById('photo').files[0]);\r\n    const updateSettings = async (data, type) => {\r\n      console.log(data, type);\r\n      try {\r\n        const url =\r\n          type === 'data'\r\n            ? '/api/v1/users/updateMe'\r\n            : '/api/v1/users/updateMyPassword';\r\n        const res = await axios({\r\n          method: 'PATCH',\r\n          url,\r\n          data: data,\r\n        });\r\n        console.log(res.status);\r\n        if (res.status === 200) {\r\n          showAlert('success', `${type} Data Updated successfully`);\r\n          //page reloading.\r\n          window.setTimeout(() => {\r\n            location.reload();\r\n          }, 1000);\r\n        }\r\n      } catch (err) {\r\n        showAlert('error', err.response.data.message);\r\n      }\r\n    };\r\n    updateSettings(form, 'data');\r\n  });\r\n}\r\n\r\nif (userPasswordForm) {\r\n  userPasswordForm.addEventListener('submit', async (e) => {\r\n    e.preventDefault(); //btn--save-password\r\n    document.querySelector('.btn--save-password').textContent = 'Updating...';\r\n    const passwordCurrent = document.getElementById('password-current').value;\r\n    const password = document.getElementById('password').value;\r\n    const confirmPassword = document.getElementById('password-confirm').value;\r\n    const updateSettings = async (data, type) => {\r\n      console.log(data, type);\r\n      try {\r\n        const url =\r\n          type === 'data'\r\n            ? '/api/v1/users/updateMe'\r\n            : '/api/v1/users/updateMyPassword';\r\n        const res = await axios({\r\n          method: 'PATCH',\r\n          url,\r\n          data: data,\r\n        });\r\n        console.log(res.status);\r\n        if (res.status === 200) {\r\n          showAlert('success', `${type} Data Updated successfully`);\r\n          //page reloading.\r\n          window.setTimeout(() => {\r\n            location.reload();\r\n          }, 1000);\r\n        }\r\n      } catch (err) {\r\n        showAlert('error', err.response.data.message);\r\n      }\r\n    };\r\n    await updateSettings(\r\n      { passwordCurrent, password, confirmPassword },\r\n      'password'\r\n    );\r\n    document.querySelector('.btn--save-password').textContent = 'SAVE PASSWORD';\r\n    document.getElementById('password-current').value = '';\r\n    document.getElementById('password').value = '';\r\n    document.getElementById('password-confirm').value = '';\r\n  });\r\n}\r\n\r\nif (tourBookButton) {\r\n  tourBookButton.addEventListener('click', async (e) => {\r\n    //e.target is the element in this case(book-button) which triggers the eventlistner.\r\n    e.target.textContent = 'Processing...';\r\n    //^ \"tour-id\" given from template converts to tourId in js bcos after '-' it cammel case it.\r\n    const { tourId } = e.target.dataset;\r\n    const stripe = Stripe(\r\n      'pk_test_51M9nnrSIH2aTZA92VigBxG04qGjmY9mETYcYcmF96MxXNo8PJyqiC3VK6zxS9DQuLuv50bvCX47fedrfRPPfSOEB00UlBeWiuT'\r\n    );\r\n    const bookTour = async (tourId) => {\r\n      try {\r\n        //1) Get Checkout sessoin from api.\r\n        //^ Without parameter's axios is set default to 'get'\r\n        const session = await axios(\r\n          `/api/v1/booking/checkout-session/${tourId}`\r\n        );\r\n\r\n        //2) Create Checkout form + Charge Credit Card.\r\n        await stripe.redirectToCheckout({\r\n          sessionId: session.data.session.id,\r\n        });\r\n      } catch (e) {\r\n        console.log(err);\r\n        showAlert('error', err);\r\n      }\r\n    };\r\n    bookTour(tourId);\r\n  });\r\n}\r\n"],"names":["console","log","$407eccdc61ba7a94$var$hideAlert","el","document","querySelector","parentElement","removeChild","$407eccdc61ba7a94$var$showAlert","type","msg","markup","insertAdjacentHTML","window","setTimeout","$407eccdc61ba7a94$var$mapBox","getElementById","$407eccdc61ba7a94$var$loginForm","$407eccdc61ba7a94$var$logOutButton","$407eccdc61ba7a94$var$userDataForm","$407eccdc61ba7a94$var$userPasswordForm","$407eccdc61ba7a94$var$tourBookButton","locations","JSON","parse","dataset","displayMap","mapboxgl","accessToken","map","Map","container","style","scrollZoom","bounds","LngLatBounds","forEach","loc","createElement","className","Marker","element","anchor","setLngLat","coordinates","addTo","Popup","offset","setHTML","day","description","extend","top","bottom","left","right","nav","NavigationControl","addControl","addEventListener","e","preventDefault","async","email","password","axios","method","data","status","location","assign","response","message","login","value","url","reload","form","FormData","append","files","res","err1","updateSettings","textContent","passwordCurrent","confirmPassword","target","tourId","stripe","Stripe","session","redirectToCheckout","sessionId","id","err"],"version":3,"file":"index.js.map","sourceRoot":"../../../"}